global
    daemon
    maxconn 5000
    log stdout local0 info
    stats timeout 30s

defaults
    mode http
    timeout connect 10000ms
    timeout client 500000ms
    timeout server 500000ms
    option httplog
    option dontlognull
    option redispatch
    retries 3
    log global

# Stats page (accessible on port 8404)
frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 30s
    stats admin if TRUE

# Main frontend
frontend mr_robot_frontend
    bind *:9999
    option httplog
    capture request header Host len 32
    default_backend mr_robot_backend

# Backend with load balancing
backend mr_robot_backend
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200

    # Health check configuration
    default-server check inter 30s fastinter 5s downinter 10s rise 2 fall 3

    # Backend servers
    server mr_robot1 mr_robot1:8888 check
    server mr_robot2 mr_robot2:8888 check
